version: '3.8'

services:
  # Think More ‰∫§‰∫íÂºèÂºÄÂèëÁéØÂ¢É
  think-more-runner:
    build:
      context: ..
      dockerfile: docker/Dockerfile.think-more
      args:
        BASE_IMAGE: swebench/sweb.eval.x86_64.base:latest
    image: think-more:latest
    container_name: think-more-runner
    working_dir: /testbed
    volumes:
      # ÊåÇËΩΩÈ°πÁõÆÁõÆÂΩï
      - ../:/workspace
      # ÊåÇËΩΩËæìÂá∫ÁõÆÂΩï
      - ../experiments/output:/workspace/output
    environment:
      # Claude Code ËÆ§ËØÅ
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - ANTHROPIC_BASE_URL=${ANTHROPIC_BASE_URL:-https://api.anthropic.com}
      # Ê®°ÂûãÈÖçÁΩÆ
      - CLAUDE_MODEL=${CLAUDE_MODEL:-sonnet}
      # Think More ÈÖçÁΩÆ
      - THINK_MORE_ENABLED=1
      - THINK_MORE_STRICT=${THINK_MORE_STRICT:-1}
      # ‰ª£ÁêÜËÆæÁΩÆ
      - http_proxy=${http_proxy:-}
      - https_proxy=${https_proxy:-}
    network_mode: host
    stdin_open: true
    tty: true
    command: >
      bash -c "
      echo '‚úÖ Think More environment ready';
      echo 'üìÅ Hooks: /root/.claude/hooks/';
      echo 'üìÅ Skills: /root/.claude/skills/';
      exec /bin/bash"

  # Think More ÊâπÈáèËØÑÊµãÊúçÂä°
  think-more-batch:
    build:
      context: ..
      dockerfile: docker/Dockerfile.think-more
      args:
        BASE_IMAGE: swebench/sweb.eval.x86_64.base:latest
    image: think-more:latest
    container_name: think-more-batch
    working_dir: /testbed
    volumes:
      - ../:/workspace
      - ../experiments/output:/workspace/output
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - ANTHROPIC_BASE_URL=${ANTHROPIC_BASE_URL:-https://api.anthropic.com}
      - CLAUDE_MODEL=${CLAUDE_MODEL:-sonnet}
      - THINK_MORE_ENABLED=1
      - THINK_MORE_STRICT=1
      - http_proxy=${http_proxy:-}
      - https_proxy=${https_proxy:-}
    network_mode: host
    stdin_open: true
    tty: true

  # Baseline ÂØπÁÖßÁªÑÔºà‰∏çÂêØÁî® Think MoreÔºâ
  baseline-runner:
    image: swebench/sweb.eval.x86_64.base:latest
    container_name: baseline-runner
    working_dir: /testbed
    volumes:
      - ../:/workspace
      - ../experiments/output:/workspace/output
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - ANTHROPIC_BASE_URL=${ANTHROPIC_BASE_URL:-https://api.anthropic.com}
      - CLAUDE_MODEL=${CLAUDE_MODEL:-sonnet}
      - THINK_MORE_ENABLED=0
      - http_proxy=${http_proxy:-}
      - https_proxy=${https_proxy:-}
    network_mode: host
    stdin_open: true
    tty: true
